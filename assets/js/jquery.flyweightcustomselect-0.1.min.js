/*!
* jQuery Custom Select Manager function
* Copyright 2011, Ray Brooks
* Requires jQuery Core 1.4+ - http://www.jquery.com/
* Dual licensed under the MIT or GPL Version 2 licenses.
*/
var customSelectManager=function(){var d=null;var c=null;var a=null;var b="";var f;var e=function(){var g=this;this.element=document.createElement("div");this.element.style.display="none";this.element.style.position="absolute";this.element.className="customSelect";document.getElementsByTagName("body")[0].appendChild(this.element);$("body, .accordionControl").bind("click keydown focus",function(h){if((!$(h.target).closest(".ui-selectmenu-menu").length)&&(!$(h.target).closest("a.placeholder").length)){d.close()}})};e.prototype={open:function(k,m){a=customSelectManager._getOriginalFromFauxSelect($(c))[0].selectedIndex-1;customHTML="</ul>";var j=k[0].length;while(j--){customHTML='<li><a data-value="'+k[1][j]+'" href="#">'+k[0][j]+"</a></li>"+customHTML}customHTML='<ul class="ui-selectmenu-menu ui-widget ui-widget-content ui-selectmenu-menu-dropdown ui-corner-bottom" style="visibility:visible;">'+customHTML;this.element.innerHTML=customHTML;this.element.style.left=m.left+"px";this.element.style.top=m.top+"px";this.element.style.display="block";var h=$(this.element);var g=$(c).width();if(g>h.width()){h.find("ul").width(g);if(h.find("ul").hasScrollBar()){h.find("li").width(g-17)}else{h.find("li").width(g)}}customSelectManager._setListToSelectedIndex();if(h.offset().top+h.height()>$(window).height()){var l=$.browser.webkit?document.body:"html";$(l).animate({scrollTop:h.offset().top-100},1000)}this.isOpen=true},close:function(){a=0;this.element.style.display="none";this.isOpen=false}};return{getData:function(g){var i=$.map($("option",g),function(k,j){return $(k).text()});var h=$.map($("option",g),function(k,j){return $(k).attr("value")});if($(g)[0].options[0].value.length===0){i.splice(0,1);h.splice(0,1)}return[i,h]},hideAndReplaceOriginalSelect:function(j){var h;try{h=j.className.match(/validate\:\([\w\d]+\)/)[0]}catch(i){h=""}var k=$(j).find("option:eq(0)").text();var g=$('<a href="#" aria-owns="'+j.id+'" class="placeholder ui-selectmenu ui-widget ui-state-default ui-selectmenu-dropdown ui-corner-all '+h+'" role="button" href="#" tabindex="0" aria-haspopup="true" id="'+j.id+'-button"><span class="ui-selectmenu-status">'+k+'</span><span class="ui-selectmenu-icon ui-icon ui-icon-triangle-1-s"></span></a>');$(j).after(g);$(j).hide();return g},addCustomSelect:function(j){var l=this.getCustomSelect();var k=$(l.element);var i=this;var g=this.hideAndReplaceOriginalSelect(j);var h=-1;h=j.selectedIndex;if(h>=0){g.find(".ui-selectmenu-status").text(j.options[h].text)}g.bind("click",function(o){o.stopPropagation();o.preventDefault();var n=g.offset();n.top+=g.height();var m=i.getData(j);c=this;if(!$(this).hasClass("disabled")){if(!l.isOpen){l.open(m,n)}else{l.close()}}});g.bind("keydown",function(n){if(n.which===$.ui.keyCode.LEFT||n.keyCode===$.ui.keyCode.RIGHT||n.keyCode===$.ui.keyCode.UP||n.keyCode===$.ui.keyCode.DOWN||n.keyCode===$.ui.keyCode.ENTER){n.stopPropagation();n.preventDefault()}switch(true){case (n.which===$.ui.keyCode.LEFT):case (n.which===$.ui.keyCode.UP):if(l.isOpen){k.trigger("select.previous",[j])}else{$(this).trigger("click")}return false;break;case (n.which===$.ui.keyCode.RIGHT):case (n.which===$.ui.keyCode.DOWN):if(l.isOpen){k.trigger("select.next",[j])}else{$(this).trigger("click")}return false;break;case (n.which===$.ui.keyCode.ENTER):case (n.which===$.ui.keyCode.TAB):if(l.isOpen){var m=k.find("li:eq("+a+") a");if(m.length>0){k.trigger("click",[m])}}else{if(n.which===$.ui.keyCode.ENTER){$(this).trigger("click");return false}else{l.close()}}break;case (n.which===$.ui.keyCode.ESCAPE):l.close();return false;break;case (n.which>=48&&n.which<=59):case (n.which>=65&&n.which<=90):case (n.which>=97&&n.which<=122):b+=String.fromCharCode(n.which);if(!l.isOpen){$(this).trigger("click")}k.trigger("select.item",[j]);clearTimeout(f);f=setTimeout(function(){b=""},1000);break}});g.bind("focus mouseover",function(m){clearTimeout(f);b="";$(this).addClass("ui-selectmenu-focus ui-state-hover")});g.bind("blur mouseout",function(m){$(this).removeClass("ui-selectmenu-focus ui-state-hover")})},getCustomSelect:function(){var g=this;if(d==null){d=new e();var h=$(d.element);h.bind("click",function(l,k){l.preventDefault();l.stopPropagation();if(l.target.nodeName.toLowerCase()!=="a"&&k===undefined){return false}if(k===undefined){k=l.target}var m=$(k).text();var i=$(k).attr("data-value");var j=customSelectManager._getOriginalFromFauxSelect($(c));j.value=i;j.find("option").removeAttr("selected");customSelectManager._getOptFromTarget(j,i).attr("selected","selected");$(c).find(".ui-selectmenu-status").text(m);j.trigger("change");d.close();a=null});h.bind("select.next",function(k,j){k.stopPropagation();k.preventDefault();if(a===null){a=0}var i=g.getData(j);a=parseInt(a+1,10).mod(i[0].length);customSelectManager._setListToSelectedIndex()});h.bind("select.previous",function(k,j){k.stopPropagation();k.preventDefault();if(a===null){a=0}var i=g.getData(j);a=parseInt(a-1,10).mod(i[0].length);customSelectManager._setListToSelectedIndex()});h.bind("select.item",function(n,m){n.stopPropagation();n.preventDefault();var l=g.getData(m);var k=false;if(a===null){a=-1}for(var j=0;j<l[0].length;j++){if($.trim(l[0][j]).substring(0,b.length).toString().toUpperCase()===b.toString().toUpperCase()){a=j;j=l[0].length;k=true}}if(k===false){b="";a=0}customSelectManager._setListToSelectedIndex()})}return d},enable:function(g){var h=customSelectManager._getFauxSelectFromOriginal(g);h.removeClass("disabled");customSelectManager.resetTabIndexes();return},disable:function(g){customSelectManager.reset(g);var h=customSelectManager._getFauxSelectFromOriginal(g);h.addClass("disabled");customSelectManager.resetTabIndexes();return},value:function(g,i){var j=customSelectManager._getFauxSelectFromOriginal(g);var h=customSelectManager._getOptFromTarget(g,i);h.attr("selected","selected");j.find(".ui-selectmenu-status").text(h.text())},destroy:function(g){return},change:function(){return},select:function(){return},index:function(){return},style:function(g,h){if(h.style==="dropdown"){var i=customSelectManager._getFauxSelectFromOriginal(g);if(!i.length){customSelectManager.addCustomSelect(g)}}return},reset:function(g){customSelectManager.value(g,g.find("option:eq(0)").attr("value"));customSelectManager.enable(g)},resetTabIndexes:function(){$('a:visible:not(.disabled), a:visible:not(.tooltip), input:visible:not("[type=hidden]")').each(function(g){this.tabIndex=g})},_getFauxSelectFromOriginal:function(g){return $("#"+g.attr("id")+"-button")},_getOriginalFromFauxSelect:function(g){return g.prev("select")},_getOptFromTarget:function(g,h){return g.find("option[value='"+h+"']")},_setListToSelectedIndex:function(){if(a===null){a=0}var h=$(d.element);var g=h.find("li:eq("+a+")");h.find("ul").scrollTop(0);h.find("li a").removeClass("hover");if(g.length>0){g.find("a").addClass("hover");h.find("ul").scrollTop(g.position().top)}},close:function(){var g=this.getCustomSelect();g.close()}}}();
