/*!
* jQuery Custom Select Manager function
* Copyright 2011, Ray Brooks
* Requires jQuery Core 1.4+ - http://www.jquery.com/
* Dual licensed under the MIT or GPL Version 2 licenses.
*/
(function(a){a.fn.flyweightCustomSelect=function(h){var c={},f=a.fn.flyweightCustomSelect.menu||null;var e=function(){var q=null,r=false,x=null,v=null,i=0,m=[];var p=function(){m=a.map(a(c.optionfilter,q),function(D,B){var C=a(D),A=C[0].index;if(a.browser.msie&&D.nodeName.toUpperCase()==="OPTGROUP"){A=null}return{type:D.nodeName.toUpperCase(),selectIndex:A,text:C.text(),value:C.attr("value"),group:C.attr("label")}})};var o=function(){var C=0,B='<ul class="'+c.classes.menu.list.base+'">';var A=function(D,E){return'<li><a  class="'+c.classes.menu.listitem.base+'"data-index="'+D+'" href="#">'+E+"</a></li>"};while(C<m.length){if(m[C].type==="OPTGROUP"){B+='<li class="'+c.classes.menu.group.base+'"><span>'+m[C].group+"</span><ul>";C+=1;while(C<m.length&&m[C].type!=="OPTGROUP"){B+=A(m[C].selectIndex,m[C].text);C+=1}B+="</ul></li>"}else{B+=A(m[C].selectIndex,m[C].text);C+=1}}x.html(B+"</ul>")};var k=function(){var A=v.width();x.width(A)};var y=function(){var F=x.outerHeight(),A=v.offset().top,D=v.height(),E=a(window).height(),C=0,B=true;if(A+D+F<E){C=A+D}else{if(A-F>0){C=A-F;B=false}else{C=A+D;x.find("ul."+c.classes.menu.list.base).height(E-C)}}x.css({left:v.offset().left+"px",top:C+"px"});return B};var l=function(A){q.value=m[A].value;q.selectedIndex=m[A].selectIndex;v.find("span."+c.classes.placeholder.text.base).text(m[A].text);a(q).trigger("change")};var n=function(A){var B;l(A);B=x.find('a[data-index="'+m[A].selectIndex+'"]');x.find("ul").scrollTop(0);x.find("a").removeClass(c.classes.menu.listitem.focus);if(B.length>0){B.addClass(c.classes.menu.listitem.focus);x.find("ul").scrollTop(B.position().top)}};var z=function(A,C){var B=m.length-1;while(B>0&&m[B][A]!==C){B-=1}return B};var w=function(A,B){n(z(A,B))};var s=function(B,A){while(A<q.options.length){if(q[A].text.toUpperCase().charCodeAt(0)===B){w("selectIndex",A);return true}A+=1}return false};var t=function(A){A=A.toUpperCase().charCodeAt(0);s(A,q.selectedIndex+1)||s(A,0)};var j=function(D){D.preventDefault();D.stopPropagation();var B=D.target,C,A;if(B.nodeName.toUpperCase()!=="A"){return false}l(z("selectIndex",parseInt(B.getAttribute("data-index"),10)));f.close();v.focus()};var u=function(B){var A=m.length;while(A){A-=1;if(m[A].selectIndex===q.selectedIndex+B){n(A);A=0}}};return function(){x=a('<div class="'+c.classes.menu.container.base+'" />').bind("click",j);a("body").append(x);return{bondToSelect:function(B,A){v=B;q=A},open:function(){if(!r){p();o();k();if(y()){x.addClass(c.classes.menu.container.dropdown);v.addClass(c.classes.placeholder.container.dropdown)}else{x.addClass(c.classes.menu.container.dropup);v.addClass(c.classes.placeholder.container.dropup)}x.addClass(c.classes.menu.container.open);v.addClass(c.classes.placeholder.container.open).focus();i=z("selectIndex",q.selectedIndex);n(i);r=true;return true}return false},close:function(){x.removeClass(c.classes.menu.container.open+" "+c.classes.menu.container.dropdown+" "+c.classes.menu.container.dropup);if(v){v.removeClass(c.classes.placeholder.container.open+" "+c.classes.placeholder.container.dropdown+" "+c.classes.placeholder.container.dropup)}r=false},destroy:function(){x.unbind();x.remove()},reset:function(){n(i);this.close()},isOpen:function(){return r},scrollDown:function(){this.open()||u(1)},scrollUp:function(){this.open()||u(-1)},pageDown:function(){this.open()||u(10)},pageUp:function(){this.open()||u(-10)},search:function(A){this.open();t(A)},getSelect:function(){return q}}}()};var g=function(j){var r;var p=function(s){s.stopPropagation();s.preventDefault();if(f.getSelect()!==j){f.close();f.bondToSelect(r,j)}f.open()||f.close()};var o=function(s){if(s.keyCode===c.keymap.left||s.keyCode===c.keymap.right||s.keyCode===c.keymap.up||s.keyCode===c.keymap.down||s.keyCode===c.keymap.enter||s.keyCode===c.keymap.space){s.preventDefault()}switch(true){case (s.keyCode===c.keymap.left):case (s.keyCode===c.keymap.up):f.scrollUp();break;case (s.keyCode===c.keymap.right):case (s.keyCode===c.keymap.down):f.scrollDown();break;case (s.keyCode===c.keymap.pgup):f.pageUp();break;case (s.keyCode===c.keymap.pgdn):f.pageDown();break;case (s.keyCode===c.keymap.enter):case (s.keyCode===c.keymap.space):a(this).trigger("click");break;case (s.keyCode===c.keymap.tab):f.close();break;case (s.keyCode===c.keymap.escape):f.reset();break;case (s.keyCode>=48&&s.keyCode<=59):case (s.keyCode>=65&&s.keyCode<=90):case (s.keyCode>=97&&s.keyCode<=122):f.search(String.fromCharCode(s.keyCode));break}};var q=function(s){f.bondToSelect(r,j);a(this).addClass(c.classes.placeholder.container.focus)};var i=function(s){a(this).removeClass(c.classes.placeholder.container.focus)};var m=function(s){a(this).addClass(c.classes.placeholder.container.hover)};var n=function(s){a(this).removeClass(c.classes.placeholder.container.hover)};var l=function(){a(j).removeAttr("disabled");!(a(j).attr("tabindex")&&c.tabindex)||r.attr("tabindex",a(j).attr("tabindex"));r.removeClass(c.classes.placeholder.container.disabled);r.click(p);r.unbind("focusin").bind("focusin",q);r.focusout(i);r.keydown(o);r.hover(m,n)};var k=function(){a(j).attr("disabled","disabled");!c.tabindex||r.removeAttr("tabindex");r.addClass(c.classes.placeholder.container.disabled);r.unbind("click").click(function(){return false});r.unbind("keydown");r.unbind("focusin").bind("focusin",function(){this.blur();return false});r.unbind("focusout");r.unbind("mouseover");r.unbind("mouseout")};return function(){r=d(j);l();a(j).after(r);a(j).hide();return{enable:function(){l()},disable:function(){k()},destroy:function(){r.unbind();r.remove();a(j).removeAttr("disabled").show()}}}()};var b={init:function(i){c=a.extend({},a.fn.flyweightCustomSelect.settings,i);if(f===null){f=a.fn.flyweightCustomSelect.menu=new e();a(document).click(function(){if(f.isOpen()){f.reset()}})}return this.each(function(){if(!a(this).data("placeHolder")){a(this).data("placeHolder",new g(this))}})},destroy:function(){f.destroy();f=a.fn.flyweightCustomSelect.menu=null;return this.each(function(){a(this).data("placeHolder").destroy();a(this).data("placeHolder",null)})},enable:function(){return this.each(function(){a(this).data("placeHolder").enable()})},disable:function(){return this.each(function(){a(this).data("placeHolder").disable()})}};var d=(function(){if(a.browser.msie&&parseInt(a.browser.version,10)<7){return function(i){return a('<div class="'+c.classes.placeholder.container.base+'"><a href="#" aria-owns="'+i.id+'" role="button" href="#" aria-haspopup="true" id="'+i.id+'-button"><span class="'+c.classes.placeholder.text.base+'">'+i.options[i.selectedIndex].text+'</span><span class="'+c.classes.placeholder.arrow.base+'"></span></a></div>')}}else{return function(i){return a('<a href="#" aria-owns="'+i.id+'" class="'+c.classes.placeholder.container.base+'" role="button" href="#" aria-haspopup="true" id="'+i.id+'-button"><span class="'+c.classes.placeholder.text.base+'">'+i.options[i.selectedIndex].text+'</span><span class="'+c.classes.placeholder.arrow.base+'"></span></a>')}}})();if(b[h]){return b[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return b.init.apply(this,arguments)}else{a.error("Method "+h+" does not exist on jQuery.flyweightCustomSelect")}}};a.fn.flyweightCustomSelect.settings={classes:{placeholder:{container:{base:"fwselect",open:"fwselect-open",dropdown:"fwselect-drop-down",dropup:"fwselect-drop-up",hover:"fwselect-hover",focus:"fwselect-focus",disabled:"fwselect-disabled"},text:{base:"fwselect-text"},arrow:{base:"fwselect-arrow"}},menu:{container:{base:"fwselect-menu",open:"fwselect-menu-open",dropdown:"fwselect-menu-drop-down",dropup:"fwselect-menu-drop-up",},list:{base:"fwselect-menu-list"},listitem:{base:"fwselect-menu-listitem",focus:"fwselect-menu-listitem-focus",hover:"fwselect-menu-listitem-hover"},group:{base:"fwselect-menu-group"}}},optionfilter:"option,optgroup",tabindex:false,keymap:{left:37,right:39,up:38,down:40,enter:13,space:32,tab:9,pgup:33,pgdn:34,escape:27}}}(jQuery));