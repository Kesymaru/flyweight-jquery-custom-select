/*!
* jQuery Custom Select Manager function
* Copyright 2011, Ray Brooks
* Requires jQuery Core 1.4+ - http://www.jquery.com/
* Dual licensed under the MIT or GPL Version 2 licenses.
*/
(function(a){var j="ontouchstart"in document.documentElement?"touchend":"click";a.fn.flyweightCustomSelect=function(k){var b={},c=a.fn.flyweightCustomSelect.menu||null,s=function(){var f=null,d=!1,g=null,i=null,k=0,h=[],m=function(){h=a.map(a(b.optionfilter,f),function(e){var b=a(e),f=b[0].index;a.browser.msie&&"OPTGROUP"===e.nodeName.toUpperCase()&&(f=null);return{type:e.nodeName.toUpperCase(),selectIndex:f,text:b.text(),value:b.attr("value"),group:b.attr("label")}})},o=function(){for(var e=0,a='<ul class="'+b.classes.menu.list.base+'">',f=function(e,a){return'<li><a  class="'+b.classes.menu.listitem.base+'"data-index="'+e+'" href="#">'+a+"</a></li>"};e<h.length;)if("OPTGROUP"===h[e].type){a+='<li class="'+b.classes.menu.group.base+'"><span>'+h[e].group+"</span><ul>";for(e+=1;e<h.length&&"OPTGROUP"!==h[e].type;)a+=f(h[e].selectIndex,h[e].text),e+=1;a+="</ul></li>"}else a+=f(h[e].selectIndex,h[e].text),e+=1;g.html(a+"</ul>")},l=function(e){f.value=h[e].value;f.selectedIndex=h[e].selectIndex;i.find("span."+b.classes.placeholder.text.base).text(h[e].text);a(f).trigger("change")},p=function(e){l(e);e=g.find('a[data-index="'+h[e].selectIndex+'"]');g.find("ul").scrollTop(0);g.find("a").removeClass(b.classes.menu.listitem.focus);0<e.length&&(e.addClass(b.classes.menu.listitem.focus),g.find("ul").scrollTop(e.position().top))},r=function(e,b){for(var a=h.length-1;0<a&&h[a][e]!==b;)a-=1;return a},v=function(e,a){for(;a<f.options.length;){if(f[a].text.toUpperCase().charCodeAt(0)===e)return p(r("selectIndex",a)),!0;a+=1}return!1},s=function(a){a.stopPropagation();a=a.target;if("A"!==a.nodeName.toUpperCase())return!1;c.touchMoved||(l(r("selectIndex",parseInt(a.getAttribute("data-index"),10))),c.close(),i.focus());return!1},t=function(a){a.stopPropagation();i.addClass(b.classes.placeholder.container.focus);c.touchMoved=!1;c.lastTouch=a.originalEvent.touches[0].pageY;return!1},u=function(a){c.touchMoved=!0;g.find("ul").scrollTop(g.find("ul").attr("scrollTop")+c.lastTouch-a.originalEvent.touches[0].pageY);c.lastTouch=a.originalEvent.touches[0].pageY},q=function(a){for(var b=h.length;b;)b-=1,h[b].selectIndex===f.selectedIndex+a&&(p(b),b=0)};return function(){g=a('<div class="'+b.classes.menu.container.base+'" />');g.bind(j,s);g.bind("touchstart",t);g.bind("touchmove",u);a("body").append(g);return{bondToSelect:function(a,b){i=a;f=b},open:function(){if(!d){m();o();var e=i.width();g.width(e);var e=g.outerHeight(),c=i.offset().top,h=i.height(),j=window.innerHeight?window.innerHeight:a(window).height(),n=0,l=!0;c+h+e<j?n=c+h:c-e>a(window).scrollTop()?(n=c-e,l=!1):(n=c+h,c=j-(n-a(window).scrollTop()),g.find("ul."+b.classes.menu.list.base).height(c>e?e:c));g.css({left:i.offset().left+"px",top:n+"px"});l?(g.addClass(b.classes.menu.container.dropdown),i.addClass(b.classes.placeholder.container.dropdown)):(g.addClass(b.classes.menu.container.dropup),i.addClass(b.classes.placeholder.container.dropup));g.addClass(b.classes.menu.container.open);i.addClass(b.classes.placeholder.container.open).focus();k=r("selectIndex",f.selectedIndex);p(k);return d=!0}return!1},close:function(){g.removeClass(b.classes.menu.container.open+" "+b.classes.menu.container.dropdown+" "+b.classes.menu.container.dropup);if(i&&(i.removeClass(b.classes.placeholder.container.open+" "+b.classes.placeholder.container.dropdown+" "+b.classes.placeholder.container.dropup),"touchend"===j))i[0].className=b.classes.placeholder.container.base;d=!1},destroy:function(){g.unbind();g.remove()},reset:function(){p(k);this.close()},isOpen:function(){return d},scrollDown:function(){this.open()||q(1)},scrollUp:function(){this.open()||q(-1)},pageDown:function(){this.open()||q(10)},pageUp:function(){this.open()||q(-10)},search:function(a){this.open();a=a.toUpperCase().charCodeAt(0);v(a,f.selectedIndex+1)||v(a,0)},getSelect:function(){return f},getCurrentPlaceHolder:function(){return i},touchMoved:!1,lastTouch:0}}()},u=function(f){var d,g=function(){return"touchend"!==j?function(a){a.stopPropagation();a.preventDefault();c.open()||c.close()}:function(a){a.stopPropagation();a.preventDefault();if(a=c.getCurrentPlaceHolder())a[0].className=b.classes.placeholder.container.base;c.bondToSelect(d,f);c.open()||c.close()}}(),i=function(a){a.stopPropagation();return!1},k=function(f){f.stopPropagation();var d=f.keyCode;(d===b.keymap.left||d===b.keymap.right||d===b.keymap.up||d===b.keymap.down||d===b.keymap.enter||d===b.keymap.space)&&f.preventDefault();switch(!0){case d===b.keymap.left:case d===b.keymap.up:c.scrollUp();break;case d===b.keymap.right:case d===b.keymap.down:c.scrollDown();break;case d===b.keymap.pgup:c.pageUp();break;case d===b.keymap.pgdn:c.pageDown();break;case d===b.keymap.enter:case d===b.keymap.space:a(this).trigger(j);break;case d===b.keymap.tab:c.close();break;case d===b.keymap.escape:c.reset();break;case 48<=d&&59>=d:case 65<=d&&90>=d:case 97<=d&&122>=d:c.search(String.fromCharCode(d))}},h=function(a){a.stopPropagation();c.bondToSelect(d,f);d.addClass(b.classes.placeholder.container.focus)},m=function(a){a.stopPropagation();d[0].className=b.classes.placeholder.container.base},o=function(){var c=function(){a(f).removeAttr("disabled");a(f).attr("tabindex")&&b.tabindex?d.attr("tabindex",a(f).attr("tabindex")):d.attr("tabindex",0);d.removeClass(b.classes.placeholder.container.disabled);d.bind(j,g)};return"touchend"!==j?function(){c();d.unbind("focus").bind("focus",h);d.unbind("blur").bind("blur",m);d.keydown(k)}:function(){c();d.unbind("touchstart").bind("touchstart",i)}}(),l=function(){var c=function(){a(f).attr("disabled","disabled");!b.tabindex||d.removeAttr("tabindex");d.addClass(b.classes.placeholder.container.disabled);d.unbind(j).bind(j,function(){return!1})};return"touchend"!==j?function(){c();d.unbind("focus").bind("focus",function(){this.blur();return!1});d.unbind("blur");d.unbind("keydown")}:function(){c();d.unbind("touchstart")}}();return function(){d=t(f);o();a(f).after(d);a(f).hide();return{enable:function(){o()},disable:function(){l()},destroy:function(){d.unbind();d.remove();a(f).removeAttr("disabled").show()}}}()},m={init:function(f){var d=function(){if("touchend"!==j)return function(){c.isOpen()&&c.reset()};var b;a(document).bind("touchstart",function(){b=!1});a(document).bind("touchmove",function(){b=!0});return function(){c.isOpen()&&!1===b&&c.reset()}}();b=a.extend({},a.fn.flyweightCustomSelect.settings,f);if(null===c)c=a.fn.flyweightCustomSelect.menu=new s,a(document).bind(j,d);return this.each(function(){a(this).data("placeHolder")||a(this).data("placeHolder",new u(this))})},destroy:function(){c.destroy();c=a.fn.flyweightCustomSelect.menu=null;a(document).unbind(j);a(document).unbind("touchmove");a(document).unbind("touchstart");return this.each(function(){a(this).data("placeHolder").destroy();a(this).data("placeHolder",null)})},enable:function(){return this.each(function(){a(this).data("placeHolder").enable()})},disable:function(){return this.each(function(){a(this).data("placeHolder").disable()})}},t=function(){return a.browser.msie&&7>parseInt(a.browser.version,10)?function(c){return a('<div class="'+b.classes.placeholder.container.base+'"><a href="#" aria-owns="'+c.id+'" role="button" href="#" aria-haspopup="true" id="'+c.id+'-button"><span class="'+b.classes.placeholder.text.base+'">'+c.options[c.selectedIndex].text+'</span><span class="'+b.classes.placeholder.arrow.base+'"></span></a></div>')}:function(c){return a('<a href="#" aria-owns="'+c.id+'" class="'+b.classes.placeholder.container.base+'" role="button" href="#" aria-haspopup="true" id="'+c.id+'-button"><span class="'+b.classes.placeholder.text.base+'">'+c.options[c.selectedIndex].text+'</span><span class="'+b.classes.placeholder.arrow.base+'"></span></a>')}}();if(m[k])return m[k].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof k||!k)return m.init.apply(this,arguments);a.error("Method "+k+" does not exist on jQuery.flyweightCustomSelect")};a.fn.flyweightCustomSelect.settings={classes:{placeholder:{container:{base:"fwselect",open:"fwselect-open",dropdown:"fwselect-drop-down",dropup:"fwselect-drop-up",focus:"fwselect-focus",disabled:"fwselect-disabled"},text:{base:"fwselect-text"},arrow:{base:"fwselect-arrow"}},menu:{container:{base:"fwselect-menu",open:"fwselect-menu-open",dropdown:"fwselect-menu-drop-down",dropup:"fwselect-menu-drop-up"},list:{base:"fwselect-menu-list"},listitem:{base:"fwselect-menu-listitem",focus:"fwselect-menu-listitem-focus"},group:{base:"fwselect-menu-group"}}},optionfilter:"option,optgroup",tabindex:!1,keymap:{left:37,right:39,up:38,down:40,enter:13,space:32,tab:9,pgup:33,pgdn:34,escape:27}}})(jQuery);