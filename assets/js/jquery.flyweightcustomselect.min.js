/*!
* jQuery Custom Select Manager function
* Copyright 2011-2012, Ray Brooks
* Requires jQuery Core 1.4+ - http://www.jquery.com/
* Dual licensed under the MIT or GPL Version 2 licenses.
*/
(function(a){var c="ontouchstart" in document.documentElement?"touchend":"click";a.fn.flyweightCustomSelect=function(d){var b={},j=a.fn.flyweightCustomSelect.menu||null,h=function(){var E=null,F=!1,C=null,B=null,A=0,D=[],q=function(){D=a.map(a(b.optionfilter,E),function(l){var k=a(l),m=k[0].index;a.browser.msie&&"OPTGROUP"===l.nodeName.toUpperCase()&&(m=null);return{type:l.nodeName.toUpperCase(),selectIndex:m,text:k.text(),value:k.attr("value"),group:k.attr("label")}})},e=function(){for(var l=0,k='<ul class="'+b.classes.menu.list.base+'">',m=function(o,n){return'<li><a  class="'+b.classes.menu.listitem.base+'"data-index="'+o+'" href="#">'+n+"</a></li>"};l<D.length;){if("OPTGROUP"===D[l].type){k+='<li class="'+b.classes.menu.group.base+'"><span>'+D[l].group+"</span><ul>";for(l+=1;l<D.length&&"OPTGROUP"!==D[l].type;){k+=m(D[l].selectIndex,D[l].text),l+=1}k+="</ul></li>"}else{k+=m(D[l].selectIndex,D[l].text),l+=1}}C.html(k+"</ul>")},y=function(k){E.value=D[k].value;E.selectedIndex=D[k].selectIndex;B.find("span."+b.classes.placeholder.text.base).text(D[k].text);a(E).trigger("change")},x=function(k){y(k);k=C.find('a[data-index="'+D[k].selectIndex+'"]');C.find("ul").scrollTop(0);C.find("a").removeClass(b.classes.menu.listitem.focus);0<k.length&&(k.addClass(b.classes.menu.listitem.focus),C.find("ul").scrollTop(k.position().top))},z=function(m,l){for(var k=D.length-1;0<k&&D[k][m]!==l;){k-=1}return k},G=function(l,k){for(;k<E.options.length;){if(E[k].text.toUpperCase().charCodeAt(0)===l){return x(z("selectIndex",k)),!0}k+=1}return !1},J=function(k){k.stopPropagation();k=k.target;if("A"!==k.nodeName.toUpperCase()){return !1}j.touchMoved||(y(z("selectIndex",parseInt(k.getAttribute("data-index"),10))),j.close(),B.focus());return !1},I=function(k){k.stopPropagation();B.addClass(b.classes.placeholder.container.focus);j.touchMoved=!1;j.lastTouch=k.originalEvent.touches[0].pageY;return !1},H=function(k){j.touchMoved=!0;var o=C.find("ul."+b.classes.menu.list.base),r=C.find("span."+b.classes.menu.scroll.base),p=o.attr("scrollTop")+j.lastTouch-k.originalEvent.touches[0].pageY,m=5+p*r.height()/o.height(),m=Math.max(5,m),m=Math.min(o.height()-r.height()-10,m);o.scrollTop(p);r.css("top",m);j.lastTouch=k.originalEvent.touches[0].pageY},w=function(l){for(var k=D.length;k;){k-=1,D[k].selectIndex===E.selectedIndex+l&&(x(k),k=0)}};return function(){C=a('<div class="'+b.classes.menu.container.base+'" />');C.bind(c,J);C.bind("touchstart",I);C.bind("touchmove",H);a("body").append(C);return{bondToSelect:function(l,k){B=l;E=k},open:function(){if(!F){q();e();var p=B.width();C.width(p);var p=C.outerHeight(),r=B.offset().top,l=B.height(),k=window.innerHeight?window.innerHeight:a(window).height(),n=0,s=!0;r+l+p<k?n=r+l:r-p>a(window).scrollTop()?(n=r-p,s=!1):(n=r+l,r=Math.min(p,k-(n-a(window).scrollTop())),C.find("ul."+b.classes.menu.list.base).height(r),"touchend"===c&&(l=a('<span class="'+b.classes.menu.scroll.base+'"></span>'),l.height(parseInt(Math.pow(r,2)/p,10)-10),C.append(l)));C.css({left:B.offset().left+"px",top:n+"px"});s?(C.addClass(b.classes.menu.container.dropdown),B.addClass(b.classes.placeholder.container.dropdown)):(C.addClass(b.classes.menu.container.dropup),B.addClass(b.classes.placeholder.container.dropup));C.addClass(b.classes.menu.container.open);B.addClass(b.classes.placeholder.container.open).focus();A=z("selectIndex",E.selectedIndex);x(A);return F=!0}return !1},close:function(){C.removeClass(b.classes.menu.container.open+" "+b.classes.menu.container.dropdown+" "+b.classes.menu.container.dropup);if(B&&(B.removeClass(b.classes.placeholder.container.open+" "+b.classes.placeholder.container.dropdown+" "+b.classes.placeholder.container.dropup),"touchend"===c)){B[0].className=b.classes.placeholder.container.base}F=!1},destroy:function(){C.unbind();C.remove()},reset:function(){x(A);this.close()},isOpen:function(){return F},scrollDown:function(){this.open()||w(1)},scrollUp:function(){this.open()||w(-1)},pageDown:function(){this.open()||w(10)},pageUp:function(){this.open()||w(-10)},search:function(k){this.open();k=k.toUpperCase().charCodeAt(0);G(k,E.selectedIndex+1)||G(k,0)},getSelect:function(){return E},getCurrentPlaceHolder:function(){return B},touchMoved:!1,lastTouch:0}}()},f=function(u){var v,s=function(){return"touchend"!==c?function(k){k.stopPropagation();k.preventDefault();j.open()||j.close()}:function(k){k.stopPropagation();k.preventDefault();if(k=j.getCurrentPlaceHolder()){k[0].className=b.classes.placeholder.container.base}j.bondToSelect(v,u);j.open()||j.close()}}(),q=function(k){k.stopPropagation();return !1},o=function(k){k.stopPropagation();var m=k.keyCode;(m===b.keymap.left||m===b.keymap.right||m===b.keymap.up||m===b.keymap.down||m===b.keymap.enter||m===b.keymap.space)&&k.preventDefault();switch(!0){case m===b.keymap.left:case m===b.keymap.up:j.scrollUp();break;case m===b.keymap.right:case m===b.keymap.down:j.scrollDown();break;case m===b.keymap.pgup:j.pageUp();break;case m===b.keymap.pgdn:j.pageDown();break;case m===b.keymap.enter:case m===b.keymap.space:a(this).trigger(c);break;case m===b.keymap.tab:j.close();break;case m===b.keymap.escape:j.reset();break;case 48<=m&&59>=m:case 65<=m&&90>=m:case 97<=m&&122>=m:j.search(String.fromCharCode(m))}},t=function(k){k.stopPropagation();j.bondToSelect(v,u);v.addClass(b.classes.placeholder.container.focus)},l=function(k){k.stopPropagation();v[0].className=b.classes.placeholder.container.base},e=function(){var k=function(){a(u).removeAttr("disabled");a(u).attr("tabindex")&&b.tabindex?v.attr("tabindex",a(u).attr("tabindex")):v.attr("tabindex",0);v.removeClass(b.classes.placeholder.container.disabled);v.bind(c,s)};return"touchend"!==c?function(){k();v.unbind("focus").bind("focus",t);v.unbind("blur").bind("blur",l);v.keydown(o)}:function(){k();v.unbind("touchstart").bind("touchstart",q)}}(),n=function(){var k=function(){a(u).attr("disabled","disabled");!b.tabindex||v.removeAttr("tabindex");v.addClass(b.classes.placeholder.container.disabled);v.unbind(c).bind(c,function(){return !1})};return"touchend"!==c?function(){k();v.unbind("focus").bind("focus",function(){this.blur();return !1});v.unbind("blur");v.unbind("keydown")}:function(){k();v.unbind("touchstart")}}();return function(){v=g(u);e();a(u).after(v);a(u).hide();return{enable:function(){e()},disable:function(){n()},destroy:function(){v.unbind();v.remove();a(u).removeAttr("disabled").show()}}}()},i={init:function(e){var k=function(){if("touchend"!==c){return function(){j.isOpen()&&j.reset()}}var l;a(document).bind("touchstart",function(){l=!1});a(document).bind("touchmove",function(){l=!0});return function(){j.isOpen()&&!1===l&&j.reset()}}();b=a.extend({},a.fn.flyweightCustomSelect.settings,e);if(null===j){j=a.fn.flyweightCustomSelect.menu=new h,a(document).bind(c,k)}return this.each(function(){a(this).data("placeHolder")||a(this).data("placeHolder",new f(this))})},destroy:function(){j.destroy();j=a.fn.flyweightCustomSelect.menu=null;a(document).unbind(c);a(document).unbind("touchmove");a(document).unbind("touchstart");return this.each(function(){a(this).data("placeHolder").destroy();a(this).data("placeHolder",null)})},enable:function(){return this.each(function(){a(this).data("placeHolder").enable()})},disable:function(){return this.each(function(){a(this).data("placeHolder").disable()})}},g=function(){return a.browser.msie&&7>parseInt(a.browser.version,10)?function(e){return a('<div class="'+b.classes.placeholder.container.base+" "+e.className+'"><a href="#" aria-owns="'+e.id+'" role="button" href="#" aria-haspopup="true" id="'+e.id+'-button"><span class="'+b.classes.placeholder.text.base+'">'+e.options[e.selectedIndex].text+'</span><span class="'+b.classes.placeholder.arrow.base+'"></span></a></div>')}:function(e){return a('<a href="#" aria-owns="'+e.id+'" class="'+b.classes.placeholder.container.base+" "+e.className+'" role="button" href="#" aria-haspopup="true" id="'+e.id+'-button"><span class="'+b.classes.placeholder.text.base+'">'+e.options[e.selectedIndex].text+'</span><span class="'+b.classes.placeholder.arrow.base+'"></span></a>')}}();if(i[d]){return i[d].apply(this,Array.prototype.slice.call(arguments,1))}if("object"===typeof d||!d){return i.init.apply(this,arguments)}a.error("Method "+d+" does not exist on jQuery.flyweightCustomSelect")};a.fn.flyweightCustomSelect.settings={classes:{placeholder:{container:{base:"fwselect",open:"fwselect-open",dropdown:"fwselect-drop-down",dropup:"fwselect-drop-up",focus:"fwselect-focus",disabled:"fwselect-disabled"},text:{base:"fwselect-text"},arrow:{base:"fwselect-arrow"}},menu:{container:{base:"fwselect-menu",open:"fwselect-menu-open",dropdown:"fwselect-menu-drop-down",dropup:"fwselect-menu-drop-up"},list:{base:"fwselect-menu-list"},listitem:{base:"fwselect-menu-listitem",focus:"fwselect-menu-listitem-focus"},group:{base:"fwselect-menu-group"},scroll:{base:"fwselect-menu-scroll"}}},optionfilter:"option,optgroup",tabindex:!1,keymap:{left:37,right:39,up:38,down:40,enter:13,space:32,tab:9,pgup:33,pgdn:34,escape:27}}})(jQuery);