/*!
* jQuery Custom Select Manager function
* Copyright 2011, Ray Brooks
* Requires jQuery Core 1.4+ - http://www.jquery.com/
* Dual licensed under the MIT or GPL Version 2 licenses.
*/
(function(b){var a=("touchstart" in document.documentElement)?"touchstart":"click";b.fn.flyweightCustomSelect=function(i){var d={},g=b.fn.flyweightCustomSelect.menu||null;var f=function(){var l=null,k=false,m=null,y=null,r=0,t=[];var n=function(){t=b.map(b(d.optionfilter,l),function(D,B){var C=b(D),A=C[0].index;if(b.browser.msie&&D.nodeName.toUpperCase()==="OPTGROUP"){A=null}return{type:D.nodeName.toUpperCase(),selectIndex:A,text:C.text(),value:C.attr("value"),group:C.attr("label")}})};var q=function(){var C=0,B='<ul class="'+d.classes.menu.list.base+'">';var A=function(D,E){return'<li><a  class="'+d.classes.menu.listitem.base+'"data-index="'+D+'" href="#">'+E+"</a></li>"};while(C<t.length){if(t[C].type==="OPTGROUP"){B+='<li class="'+d.classes.menu.group.base+'"><span>'+t[C].group+"</span><ul>";C+=1;while(C<t.length&&t[C].type!=="OPTGROUP"){B+=A(t[C].selectIndex,t[C].text);C+=1}B+="</ul></li>"}else{B+=A(t[C].selectIndex,t[C].text);C+=1}}m.html(B+"</ul>")};var u=function(){var A=y.width();m.width(A)};var j=function(){var F=m.outerHeight(),A=y.offset().top,D=y.height(),E=document.documentElement.clientHeight,C=0,B=true;if(A+D+F<E){C=A+D}else{if(A-F>b(window).scrollTop()){C=A-F;B=false}else{C=A+D;m.find("ul."+d.classes.menu.list.base).height(E-C)}}m.css({left:y.offset().left+"px",top:C+"px"});return B};var z=function(A){l.value=t[A].value;l.selectedIndex=t[A].selectIndex;y.find("span."+d.classes.placeholder.text.base).text(t[A].text);b(l).trigger("change")};var p=function(A){var B;z(A);B=m.find('a[data-index="'+t[A].selectIndex+'"]');m.find("ul").scrollTop(0);m.find("a").removeClass(d.classes.menu.listitem.focus);if(B.length>0){B.addClass(d.classes.menu.listitem.focus);m.find("ul").scrollTop(B.position().top)}};var x=function(A,C){var B=t.length-1;while(B>0&&t[B][A]!==C){B-=1}return B};var v=function(B,A){while(A<l.options.length){if(l[A].text.toUpperCase().charCodeAt(0)===B){p(x("selectIndex",A));return true}A+=1}return false};var o=function(A){A=A.toUpperCase().charCodeAt(0);v(A,l.selectedIndex+1)||v(A,0)};var w=function(D){D.preventDefault();D.stopPropagation();var B=D.target,C,A;if(B.nodeName.toUpperCase()!=="A"){return false}z(x("selectIndex",parseInt(B.getAttribute("data-index"),10)));g.close();y.focus()};var s=function(B){var A=t.length;while(A){A-=1;if(t[A].selectIndex===l.selectedIndex+B){p(A);A=0}}};return function(){m=b('<div class="'+d.classes.menu.container.base+'" />').bind(a,w);b("body").append(m);return{bondToSelect:function(B,A){y=B;l=A},open:function(){if(!k){n();q();u();if(j()){m.addClass(d.classes.menu.container.dropdown);y.addClass(d.classes.placeholder.container.dropdown)}else{m.addClass(d.classes.menu.container.dropup);y.addClass(d.classes.placeholder.container.dropup)}m.addClass(d.classes.menu.container.open);y.addClass(d.classes.placeholder.container.open).focus();r=x("selectIndex",l.selectedIndex);p(r);k=true;return true}return false},close:function(){m.removeClass(d.classes.menu.container.open+" "+d.classes.menu.container.dropdown+" "+d.classes.menu.container.dropup);if(y){y.removeClass(d.classes.placeholder.container.open+" "+d.classes.placeholder.container.dropdown+" "+d.classes.placeholder.container.dropup)}k=false},destroy:function(){m.unbind();m.remove()},reset:function(){p(r);this.close()},isOpen:function(){return k},scrollDown:function(){this.open()||s(1)},scrollUp:function(){this.open()||s(-1)},pageDown:function(){this.open()||s(10)},pageUp:function(){this.open()||s(-10)},search:function(A){this.open();o(A)},getSelect:function(){return l}}}()};var h=function(q){var n;var p=function(r){r.stopPropagation();r.preventDefault();g.open()||g.close()};var l=function(r){r.stopPropagation();if(r.keyCode===d.keymap.left||r.keyCode===d.keymap.right||r.keyCode===d.keymap.up||r.keyCode===d.keymap.down||r.keyCode===d.keymap.enter||r.keyCode===d.keymap.space){r.preventDefault()}switch(true){case (r.keyCode===d.keymap.left):case (r.keyCode===d.keymap.up):g.scrollUp();break;case (r.keyCode===d.keymap.right):case (r.keyCode===d.keymap.down):g.scrollDown();break;case (r.keyCode===d.keymap.pgup):g.pageUp();break;case (r.keyCode===d.keymap.pgdn):g.pageDown();break;case (r.keyCode===d.keymap.enter):case (r.keyCode===d.keymap.space):b(this).trigger(a);break;case (r.keyCode===d.keymap.tab):g.close();break;case (r.keyCode===d.keymap.escape):g.reset();break;case (r.keyCode>=48&&r.keyCode<=59):case (r.keyCode>=65&&r.keyCode<=90):case (r.keyCode>=97&&r.keyCode<=122):g.search(String.fromCharCode(r.keyCode));break}};var m=function(r){r.stopPropagation();g.bondToSelect(n,q);n.addClass(d.classes.placeholder.container.focus)};var o=function(r){r.stopPropagation();n[0].className=d.classes.placeholder.container.base};var k=function(){b(q).removeAttr("disabled");if(b(q).attr("tabindex")&&d.tabindex){n.attr("tabindex",b(q).attr("tabindex"))}else{n.attr("tabindex",0)}n.removeClass(d.classes.placeholder.container.disabled);n.bind(a,p);n.unbind("focus").bind("focus",m);n.unbind("blur").bind("blur",o);n.keydown(l)};var j=function(){b(q).attr("disabled","disabled");!d.tabindex||n.removeAttr("tabindex");n.addClass(d.classes.placeholder.container.disabled);n.unbind(a).bind(a,function(){return false});n.unbind("keydown");n.unbind("focus").bind("focus",function(){this.blur();return false});n.unbind("blur")};return function(){n=e(q);k();b(q).after(n);b(q).hide();return{enable:function(){k()},disable:function(){j()},destroy:function(){n.unbind();n.remove();b(q).removeAttr("disabled").show()}}}()};var c={init:function(j){d=b.extend({},b.fn.flyweightCustomSelect.settings,j);if(g===null){g=b.fn.flyweightCustomSelect.menu=new f();b(document).bind(a,function(){if(g.isOpen()){g.reset()}})}return this.each(function(){if(!b(this).data("placeHolder")){b(this).data("placeHolder",new h(this))}})},destroy:function(){g.destroy();g=b.fn.flyweightCustomSelect.menu=null;return this.each(function(){b(this).data("placeHolder").destroy();b(this).data("placeHolder",null)})},enable:function(){return this.each(function(){b(this).data("placeHolder").enable()})},disable:function(){return this.each(function(){b(this).data("placeHolder").disable()})}};var e=(function(){if(b.browser.msie&&parseInt(b.browser.version,10)<7){return function(j){return b('<div class="'+d.classes.placeholder.container.base+'"><a href="#" aria-owns="'+j.id+'" role="button" href="#" aria-haspopup="true" id="'+j.id+'-button"><span class="'+d.classes.placeholder.text.base+'">'+j.options[j.selectedIndex].text+'</span><span class="'+d.classes.placeholder.arrow.base+'"></span></a></div>')}}else{return function(j){return b('<a href="#" aria-owns="'+j.id+'" class="'+d.classes.placeholder.container.base+'" role="button" href="#" aria-haspopup="true" id="'+j.id+'-button"><span class="'+d.classes.placeholder.text.base+'">'+j.options[j.selectedIndex].text+'</span><span class="'+d.classes.placeholder.arrow.base+'"></span></a>')}}})();if(c[i]){return c[i].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof i==="object"||!i){return c.init.apply(this,arguments)}else{b.error("Method "+i+" does not exist on jQuery.flyweightCustomSelect")}}};b.fn.flyweightCustomSelect.settings={classes:{placeholder:{container:{base:"fwselect",open:"fwselect-open",dropdown:"fwselect-drop-down",dropup:"fwselect-drop-up",focus:"fwselect-focus",disabled:"fwselect-disabled"},text:{base:"fwselect-text"},arrow:{base:"fwselect-arrow"}},menu:{container:{base:"fwselect-menu",open:"fwselect-menu-open",dropdown:"fwselect-menu-drop-down",dropup:"fwselect-menu-drop-up"},list:{base:"fwselect-menu-list"},listitem:{base:"fwselect-menu-listitem",focus:"fwselect-menu-listitem-focus",},group:{base:"fwselect-menu-group"}}},optionfilter:"option,optgroup",tabindex:false,keymap:{left:37,right:39,up:38,down:40,enter:13,space:32,tab:9,pgup:33,pgdn:34,escape:27}}}(jQuery));