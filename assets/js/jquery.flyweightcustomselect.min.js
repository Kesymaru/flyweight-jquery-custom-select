/*!
* jQuery Custom Select Manager function
* Copyright 2011, Ray Brooks
* Requires jQuery Core 1.4+ - http://www.jquery.com/
* Dual licensed under the MIT or GPL Version 2 licenses.
*/
(function(a){a.fn.flyweightCustomSelect=function(h){var d={},f=a.fn.flyweightCustomSelect.menu||null;var c=function(j,i){return((i%j)+j)%j};var e=function(){var y=null,s=null,t=false,o=null,i=0,n=[];var r=function(){n=a.map(a(d.optionfilter,s),function(F,D){var E=a(F),C=E[0].index;if(a.browser.msie&&F.nodeName.toUpperCase()==="OPTGROUP"){C=null}return{type:F.nodeName.toUpperCase(),selectIndex:C,text:E.text(),value:E.attr("value"),group:E.attr("label")}})};var q=function(){var E=0,D='<ul class="'+d.classes.menu.list.base+'">';var C=function(F,G){return'<li><a  class="'+d.classes.menu.listitem.base+'"data-index="'+F+'" href="#">'+G+"</a></li>"};while(E<n.length){if(n[E].type==="OPTGROUP"){D+='<li class="'+d.classes.menu.group.base+'"><span>'+n[E].group+"</span><ul>";E+=1;while(E<n.length&&n[E].type!=="OPTGROUP"){D+=C(n[E].selectIndex,n[E].text);E+=1}D+="</ul></li>"}else{D+=C(n[E].selectIndex,n[E].text);E+=1}}o.html(D+"</ul>")};var A=function(){var C=a(y).offset();C.top+=a(y).height();o.css({left:C.left+"px",top:C.top+"px"})};var j=function(C){if((C.clientHeight<C.scrollHeight)||(C.clientWidth<C.scrollWidth)){return true}return false};var k=function(){var C=a(s).width();if(C>o.width()){o.find("ul").width(C);if(j(o.find("ul"))){o.find("li").width(C-17)}else{o.find("li").width(C)}}};var w=function(){if(o.offset().top+o.height()>a(window).height()){var C=a.browser.webkit?window.document.body:"html";a(C).animate({scrollTop:parseInt(o.position().top,10)-100},1000)}};var m=function(C){s.value=n[C].value;s.selectedIndex=n[C].selectIndex;a(y).find("span."+d.classes.placeholder.text.base).text(n[C].text);a(s).trigger("change")};var p=function(C){var D;m(C);D=o.find('a[data-index="'+n[C].selectIndex+'"]');o.find("ul").scrollTop(0);o.find("a").removeClass(d.classes.menu.listitem.focus);if(D.length>0){D.addClass(d.classes.menu.listitem.focus);o.find("ul").scrollTop(D.position().top)}};var B=function(C,E){var D=n.length-1;while(D>0&&n[D][C]!==E){D-=1}return D};var z=function(C,D){p(B(C,D))};var u=function(D,C){while(C<s.options.length){if(s[C].text.toUpperCase().charCodeAt(0)===D){z("selectIndex",C);return true}C+=1}return false};var v=function(C){C=C.toUpperCase().charCodeAt(0);u(C,s.selectedIndex+1)||u(C,0)};var l=function(F){var D=F.target,E,C;F.preventDefault();F.stopPropagation();if(D.nodeName.toUpperCase()!=="A"){return false}m(B("selectIndex",parseInt(D.getAttribute("data-index"),10)));f.close();y.focus()};var x=function(D){var C=n.length;while(C){C-=1;if(n[C].selectIndex===s.selectedIndex+D){p(C);C=0}}};o=a('<div class="'+d.classes.menu.container.base+'" />').bind("click",l);a("body").append(o);return{initialise:function(D,C){y=D;s=C},open:function(){if(!t){r();q();A();k();w();i=B("selectIndex",s.selectedIndex);p(i);o.addClass(d.classes.menu.container.open);a(y).addClass(d.classes.placeholder.container.open).focus();t=true;return true}return false},close:function(){o.removeClass(d.classes.menu.container.open);a(y).removeClass(d.classes.placeholder.container.open);t=false},destroy:function(){o.unbind();o.remove()},reset:function(){p(i);this.close()},isOpen:function(){return t},scrollDown:function(){this.open()||x(1)},scrollUp:function(){this.open()||x(-1)},pageDown:function(){this.open()||x(10)},pageUp:function(){this.open()||x(-10)},search:function(C){this.open();v(C)},getSelect:function(){return s}}};var g=function(j){var r;var p=function(s){s.stopPropagation();s.preventDefault();if(f.getSelect()!==j){f.close();f.initialise(this,j)}f.open()||f.close()};var k=function(s){if(s.which===d.keymap.left||s.keyCode===d.keymap.right||s.keyCode===d.keymap.up||s.keyCode===d.keymap.down||s.keyCode===d.keymap.enter||s.keyCode===d.keymap.space){s.stopPropagation();s.preventDefault()}switch(true){case (s.which===d.keymap.left):case (s.which===d.keymap.up):f.scrollUp();break;case (s.which===d.keymap.right):case (s.which===d.keymap.down):f.scrollDown();break;case (s.which===d.keymap.pgup):f.pageUp();break;case (s.which===d.keymap.pgdn):f.pageDown();break;case (s.which===d.keymap.enter):case (s.which===d.keymap.space):a(this).trigger("click");break;case (s.which===d.keymap.tab):f.close();break;case (s.which===d.keymap.escape):f.reset();break;case (s.which>=48&&s.which<=59):case (s.which>=65&&s.which<=90):case (s.which>=97&&s.which<=122):f.search(String.fromCharCode(s.which));break}};var q=function(s){f.initialise(a(this),j);a(this).addClass(d.classes.placeholder.container.focus)};var i=function(s){a(this).removeClass(d.classes.placeholder.container.focus)};var n=function(s){a(this).addClass(d.classes.placeholder.container.hover)};var o=function(s){a(this).removeClass(d.classes.placeholder.container.hover)};var m=function(){a(j).removeAttr("disabled");!(a(j).attr("tabindex")&&d.tabindex)||r.attr("tabindex",a(j).attr("tabindex"));r.removeClass(d.classes.placeholder.container.disabled);r.click(p);r.keydown(k);r.unbind("focus").focus(q);r.blur(i);r.hover(n,o)};var l=function(){a(j).attr("disabled","disabled");!d.tabindex||r.removeAttr("tabindex");r.addClass(d.classes.placeholder.container.disabled);r.unbind("click").click(function(){return false});r.unbind("keydown");r.unbind("focus").focus(function(){this.blur();return false});r.unbind("blur");r.unbind("mouseover");r.unbind("mouseout")};r=a('<a href="#" aria-owns="'+j.id+'" class="'+d.classes.placeholder.container.base+'" role="button" href="#" aria-haspopup="true" id="'+j.id+'-button"><span class="'+d.classes.placeholder.text.base+'">'+j.options[j.selectedIndex].text+'</span><span class="'+d.classes.placeholder.arrow.base+'"></span></a>');m();a(j).after(r);a(j).hide();return{enable:function(){m()},disable:function(){l()},destroy:function(){r.unbind();r.remove();a(j).removeAttr("disabled").show()}}};var b={init:function(i){d=a.extend({},a.fn.flyweightCustomSelect.settings,i);if(f===null){f=a.fn.flyweightCustomSelect.menu=new e();a(document).click(function(){if(f.isOpen()){f.reset()}})}return this.each(function(){if(!a(this).data("placeHolder")){a(this).data("placeHolder",new g(this))}})},destroy:function(){f.destroy();f=a.fn.flyweightCustomSelect.menu=null;return this.each(function(){a(this).data("placeHolder").destroy();a(this).data("placeHolder",null)})},enable:function(){return this.each(function(){a(this).data("placeHolder").enable()})},disable:function(){return this.each(function(){a(this).data("placeHolder").disable()})}};if(b[h]){return b[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return b.init.apply(this,arguments)}else{a.error("Method "+h+" does not exist on jQuery.flyweightCustomSelect")}}};a.fn.flyweightCustomSelect.settings={classes:{placeholder:{container:{base:"fwselect",open:"fwselect-open",hover:"fwselect-hover",focus:"fwselect-focus",disabled:"fwselect-disabled"},text:{base:"fwselect-text"},arrow:{base:"fwselect-arrow"}},menu:{container:{base:"fwselect-menu",open:"fwselect-menu-open"},list:{base:"fwselect-menu-list"},listitem:{base:"fwselect-menu-listitem",focus:"fwselect-menu-listitem-focus",hover:"fwselect-menu-listitem-hover"},group:{base:"fwselect-menu-group"}}},optionfilter:"option,optgroup",tabindex:false,keymap:{left:37,right:39,up:38,down:40,enter:13,space:32,tab:9,pgup:33,pgdn:34,escape:27}}}(jQuery));