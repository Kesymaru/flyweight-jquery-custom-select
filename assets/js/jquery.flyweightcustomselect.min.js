/*!
* jQuery Custom Select Manager function
* Copyright 2011, Ray Brooks
* Requires jQuery Core 1.4+ - http://www.jquery.com/
* Dual licensed under the MIT or GPL Version 2 licenses.
*/
(function(c){var k="ontouchstart"in document.documentElement?"touchend":"click";c.fn.flyweightCustomSelect=function(l){var b={},e=c.fn.flyweightCustomSelect.menu||null,p=function(){var d=null,g=!1,i=null,j=null,l=0,h=[],v=function(){h=c.map(c(b.optionfilter,d),function(f){var b=c(f),a=b[0].index;c.browser.msie&&"OPTGROUP"===f.nodeName.toUpperCase()&&(a=null);return{type:f.nodeName.toUpperCase(),selectIndex:a,text:b.text(),value:b.attr("value"),group:b.attr("label")}})},m=function(){for(var f=0,a='<ul class="'+b.classes.menu.list.base+'">',c=function(a,f){return'<li><a  class="'+b.classes.menu.listitem.base+'"data-index="'+a+'" href="#">'+f+"</a></li>"};f<h.length;)if("OPTGROUP"===h[f].type){a+='<li class="'+b.classes.menu.group.base+'"><span>'+h[f].group+"</span><ul>";for(f+=1;f<h.length&&"OPTGROUP"!==h[f].type;)a+=c(h[f].selectIndex,h[f].text),f+=1;a+="</ul></li>"}else a+=c(h[f].selectIndex,h[f].text),f+=1;i.html(a+"</ul>")},a=function(a){d.value=h[a].value;d.selectedIndex=h[a].selectIndex;j.find("span."+b.classes.placeholder.text.base).text(h[a].text);c(d).trigger("change")},q=function(f){a(f);f=i.find('a[data-index="'+h[f].selectIndex+'"]');i.find("ul").scrollTop(0);i.find("a").removeClass(b.classes.menu.listitem.focus);0<f.length&&(f.addClass(b.classes.menu.listitem.focus),i.find("ul").scrollTop(f.position().top))},r=function(a,b){for(var c=h.length-1;0<c&&h[c][a]!==b;)c-=1;return c},u=function(a,b){for(;b<d.options.length;){if(d[b].text.toUpperCase().charCodeAt(0)===a)return q(r("selectIndex",b)),!0;b+=1}return!1},p=function(b){if(e.touchMoved)return!1;b.preventDefault();b.stopPropagation();b=b.target;if("A"!==b.nodeName.toUpperCase())return!1;a(r("selectIndex",parseInt(b.getAttribute("data-index"),10)));e.close();j.focus()},s=function(){j.addClass(b.classes.placeholder.container.focus);e.touchMoved=!1},t=function(){e.touchMoved=!0},n=function(b){for(var a=h.length;a;)a-=1,h[a].selectIndex===d.selectedIndex+b&&(q(a),a=0)};return function(){i=c('<div class="'+b.classes.menu.container.base+'" />');i.bind(k,p);i.bind("touchstart",s);i.bind("touchmove",t);c("body").append(i);return{bondToSelect:function(a,b){j=a;d=b},open:function(){if(!g){v();m();var a=j.width();i.width(a);var a=i.outerHeight(),e=j.offset().top,h=j.height(),k=document.documentElement.clientHeight,o=0,n=!0;e+h+a<k?o=e+h:e-a>c(window).scrollTop()?(o=e-a,n=!1):(o=e+h,i.find("ul."+b.classes.menu.list.base).height(k-o));i.css({left:j.offset().left+"px",top:o+"px"});n?(i.addClass(b.classes.menu.container.dropdown),j.addClass(b.classes.placeholder.container.dropdown)):(i.addClass(b.classes.menu.container.dropup),j.addClass(b.classes.placeholder.container.dropup));i.addClass(b.classes.menu.container.open);j.addClass(b.classes.placeholder.container.open).focus();l=r("selectIndex",d.selectedIndex);q(l);return g=!0}return!1},close:function(){i.removeClass(b.classes.menu.container.open+" "+b.classes.menu.container.dropdown+" "+b.classes.menu.container.dropup);if(j&&(j.removeClass(b.classes.placeholder.container.open+" "+b.classes.placeholder.container.dropdown+" "+b.classes.placeholder.container.dropup),"touchend"===k))j[0].className=b.classes.placeholder.container.base;g=!1},destroy:function(){i.unbind();i.remove()},reset:function(){q(l);this.close()},isOpen:function(){return g},scrollDown:function(){this.open()||n(1)},scrollUp:function(){this.open()||n(-1)},pageDown:function(){this.open()||n(10)},pageUp:function(){this.open()||n(-10)},search:function(a){this.open();a=a.toUpperCase().charCodeAt(0);u(a,d.selectedIndex+1)||u(a,0)},getSelect:function(){return d},getCurrentPlaceHolder:function(){return j},touchMoved:!1}}()},t=function(d){var g,i=function(){return"touchend"!==k?function(a){a.stopPropagation();a.preventDefault();e.open()||e.close()}:function(a){a.stopPropagation();a.preventDefault();if(a=e.getCurrentPlaceHolder())a[0].className=b.classes.placeholder.container.base;e.bondToSelect(g,d);e.open()||e.close()}}(),j=function(a){a.stopPropagation();(a.keyCode===b.keymap.left||a.keyCode===b.keymap.right||a.keyCode===b.keymap.up||a.keyCode===b.keymap.down||a.keyCode===b.keymap.enter||a.keyCode===b.keymap.space)&&a.preventDefault();switch(!0){case a.keyCode===b.keymap.left:case a.keyCode===b.keymap.up:e.scrollUp();break;case a.keyCode===b.keymap.right:case a.keyCode===b.keymap.down:e.scrollDown();break;case a.keyCode===b.keymap.pgup:e.pageUp();break;case a.keyCode===b.keymap.pgdn:e.pageDown();break;case a.keyCode===b.keymap.enter:case a.keyCode===b.keymap.space:c(this).trigger(k);break;case a.keyCode===b.keymap.tab:e.close();break;case a.keyCode===b.keymap.escape:e.reset();break;case 48<=a.keyCode&&59>=a.keyCode:case 65<=a.keyCode&&90>=a.keyCode:case 97<=a.keyCode&&122>=a.keyCode:e.search(String.fromCharCode(a.keyCode))}},l=function(a){a.stopPropagation();e.bondToSelect(g,d);g.addClass(b.classes.placeholder.container.focus)},h=function(a){a.stopPropagation();g[0].className=b.classes.placeholder.container.base},m=function(){var a=function(){c(d).removeAttr("disabled");c(d).attr("tabindex")&&b.tabindex?g.attr("tabindex",c(d).attr("tabindex")):g.attr("tabindex",0);g.removeClass(b.classes.placeholder.container.disabled);g.bind(k,i)};return"touchend"!==k?function(){a();g.unbind("focus").bind("focus",l);g.unbind("blur").bind("blur",h);g.keydown(j)}:function(){a()}}(),p=function(){var a=function(){c(d).attr("disabled","disabled");!b.tabindex||g.removeAttr("tabindex");g.addClass(b.classes.placeholder.container.disabled);g.unbind(k).bind(k,function(){return!1})};return"touchend"!==k?function(){a();g.unbind("focus").bind("focus",function(){this.blur();return!1});g.unbind("blur");g.unbind("keydown")}:function(){a()}}();return function(){g=s(d);m();c(d).after(g);c(d).hide();return{enable:function(){m()},disable:function(){p()},destroy:function(){g.unbind();g.remove();c(d).removeAttr("disabled").show()}}}()},m={init:function(d){b=c.extend({},c.fn.flyweightCustomSelect.settings,d);if(null===e)e=c.fn.flyweightCustomSelect.menu=new p,c(document).bind(k,function(){e.isOpen()&&e.reset()});return this.each(function(){c(this).data("placeHolder")||c(this).data("placeHolder",new t(this))})},destroy:function(){e.destroy();e=c.fn.flyweightCustomSelect.menu=null;return this.each(function(){c(this).data("placeHolder").destroy();c(this).data("placeHolder",null)})},enable:function(){return this.each(function(){c(this).data("placeHolder").enable()})},disable:function(){return this.each(function(){c(this).data("placeHolder").disable()})}},s=function(){return c.browser.msie&&7>parseInt(c.browser.version,10)?function(d){return c('<div class="'+b.classes.placeholder.container.base+'"><a href="#" aria-owns="'+d.id+'" role="button" href="#" aria-haspopup="true" id="'+d.id+'-button"><span class="'+b.classes.placeholder.text.base+'">'+d.options[d.selectedIndex].text+'</span><span class="'+b.classes.placeholder.arrow.base+'"></span></a></div>')}:function(d){return c('<a href="#" aria-owns="'+d.id+'" class="'+b.classes.placeholder.container.base+'" role="button" href="#" aria-haspopup="true" id="'+d.id+'-button"><span class="'+b.classes.placeholder.text.base+'">'+d.options[d.selectedIndex].text+'</span><span class="'+b.classes.placeholder.arrow.base+'"></span></a>')}}();if(m[l])return m[l].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof l||!l)return m.init.apply(this,arguments);c.error("Method "+l+" does not exist on jQuery.flyweightCustomSelect")};c.fn.flyweightCustomSelect.settings={classes:{placeholder:{container:{base:"fwselect",open:"fwselect-open",dropdown:"fwselect-drop-down",dropup:"fwselect-drop-up",focus:"fwselect-focus",disabled:"fwselect-disabled"},text:{base:"fwselect-text"},arrow:{base:"fwselect-arrow"}},menu:{container:{base:"fwselect-menu",open:"fwselect-menu-open",dropdown:"fwselect-menu-drop-down",dropup:"fwselect-menu-drop-up"},list:{base:"fwselect-menu-list"},listitem:{base:"fwselect-menu-listitem",focus:"fwselect-menu-listitem-focus"},group:{base:"fwselect-menu-group"}}},optionfilter:"option,optgroup",tabindex:!1,keymap:{left:37,right:39,up:38,down:40,enter:13,space:32,tab:9,pgup:33,pgdn:34,escape:27}}})(jQuery);