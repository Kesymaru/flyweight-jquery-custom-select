/*!
* jQuery Custom Select Manager function
* Copyright 2011, Ray Brooks
* Requires jQuery Core 1.4+ - http://www.jquery.com/
* Dual licensed under the MIT or GPL Version 2 licenses.
*/
(function(a){a.fn.flyweightCustomSelect=function(h){var c={},f=a.fn.flyweightCustomSelect.menu||null;var e=function(){var r=null,s=false,y=null,w=null,i=0,n=[];var q=function(){n=a.map(a(c.optionfilter,r),function(E,C){var D=a(E),B=D[0].index;if(a.browser.msie&&E.nodeName.toUpperCase()==="OPTGROUP"){B=null}return{type:E.nodeName.toUpperCase(),selectIndex:B,text:D.text(),value:D.attr("value"),group:D.attr("label")}})};var p=function(){var D=0,C='<ul class="'+c.classes.menu.list.base+'">';var B=function(E,F){return'<li><a  class="'+c.classes.menu.listitem.base+'"data-index="'+E+'" href="#">'+F+"</a></li>"};while(D<n.length){if(n[D].type==="OPTGROUP"){C+='<li class="'+c.classes.menu.group.base+'"><span>'+n[D].group+"</span><ul>";D+=1;while(D<n.length&&n[D].type!=="OPTGROUP"){C+=B(n[D].selectIndex,n[D].text);D+=1}C+="</ul></li>"}else{C+=B(n[D].selectIndex,n[D].text);D+=1}}y.html(C+"</ul>")};var l=function(){var B=w.width();y.width(B)};var z=function(){var G=y.outerHeight(),B=w.offset().top,E=w.height(),F=a(window).height(),D=0,C=true;if(B+E+G<F){D=B+E}else{if(B-G>0){D=B-G;C=false}else{D=B+E;y.find("ul."+c.classes.menu.list.base).height(F-D)}}y.css({left:w.offset().left+"px",top:D+"px"});return C};var j=function(B){if((B.clientHeight<B.scrollHeight)||(B.clientWidth<B.scrollWidth)){return true}return false};var m=function(B){r.value=n[B].value;r.selectedIndex=n[B].selectIndex;w.find("span."+c.classes.placeholder.text.base).text(n[B].text);a(r).trigger("change")};var o=function(B){var C;m(B);C=y.find('a[data-index="'+n[B].selectIndex+'"]');y.find("ul").scrollTop(0);y.find("a").removeClass(c.classes.menu.listitem.focus);if(C.length>0){C.addClass(c.classes.menu.listitem.focus);y.find("ul").scrollTop(C.position().top)}};var A=function(B,D){var C=n.length-1;while(C>0&&n[C][B]!==D){C-=1}return C};var x=function(B,C){o(A(B,C))};var t=function(C,B){while(B<r.options.length){if(r[B].text.toUpperCase().charCodeAt(0)===C){x("selectIndex",B);return true}B+=1}return false};var u=function(B){B=B.toUpperCase().charCodeAt(0);t(B,r.selectedIndex+1)||t(B,0)};var k=function(E){E.preventDefault();E.stopPropagation();var C=E.target,D,B;if(C.nodeName.toUpperCase()!=="A"){return false}m(A("selectIndex",parseInt(C.getAttribute("data-index"),10)));f.close();w.focus()};var v=function(C){var B=n.length;while(B){B-=1;if(n[B].selectIndex===r.selectedIndex+C){o(B);B=0}}};return function(){y=a('<div class="'+c.classes.menu.container.base+'" />').bind("click",k);a("body").append(y);return{bondToSelect:function(C,B){w=C;r=B},open:function(){if(!s){q();p();l();if(z()){y.addClass(c.classes.menu.container.dropdown);w.addClass(c.classes.placeholder.container.dropdown)}else{y.addClass(c.classes.menu.container.dropup);w.addClass(c.classes.placeholder.container.dropup)}y.addClass(c.classes.menu.container.open);w.addClass(c.classes.placeholder.container.open).focus();i=A("selectIndex",r.selectedIndex);o(i);s=true;return true}return false},close:function(){y.removeClass(c.classes.menu.container.open+" "+c.classes.menu.container.dropdown+" "+c.classes.menu.container.dropup);if(w){w.removeClass(c.classes.placeholder.container.open+" "+c.classes.placeholder.container.dropdown+" "+c.classes.placeholder.container.dropup)}s=false},destroy:function(){y.unbind();y.remove()},reset:function(){o(i);this.close()},isOpen:function(){return s},scrollDown:function(){this.open()||v(1)},scrollUp:function(){this.open()||v(-1)},pageDown:function(){this.open()||v(10)},pageUp:function(){this.open()||v(-10)},search:function(B){this.open();u(B)},getSelect:function(){return r}}}()};var g=function(j){var r;var p=function(s){s.stopPropagation();s.preventDefault();if(f.getSelect()!==j){f.close();f.bondToSelect(r,j)}f.open()||f.close()};var o=function(s){if(s.keyCode===c.keymap.left||s.keyCode===c.keymap.right||s.keyCode===c.keymap.up||s.keyCode===c.keymap.down||s.keyCode===c.keymap.enter||s.keyCode===c.keymap.space){s.stopPropagation();s.preventDefault()}switch(true){case (s.keyCode===c.keymap.left):case (s.keyCode===c.keymap.up):f.scrollUp();break;case (s.keyCode===c.keymap.right):case (s.keyCode===c.keymap.down):f.scrollDown();break;case (s.keyCode===c.keymap.pgup):f.pageUp();break;case (s.keyCode===c.keymap.pgdn):f.pageDown();break;case (s.keyCode===c.keymap.enter):case (s.keyCode===c.keymap.space):a(this).trigger("click");break;case (s.keyCode===c.keymap.tab):f.close();break;case (s.keyCode===c.keymap.escape):f.reset();break;case (s.keyCode>=48&&s.keyCode<=59):case (s.keyCode>=65&&s.keyCode<=90):case (s.keyCode>=97&&s.keyCode<=122):f.search(String.fromCharCode(s.keyCode));break}};var q=function(s){s.stopPropagation();s.preventDefault();f.bondToSelect(r,j);a(this).addClass(c.classes.placeholder.container.focus)};var i=function(s){s.stopPropagation();s.preventDefault();a(this).removeClass(c.classes.placeholder.container.focus)};var m=function(s){a(this).addClass(c.classes.placeholder.container.hover)};var n=function(s){a(this).removeClass(c.classes.placeholder.container.hover)};var l=function(){a(j).removeAttr("disabled");!(a(j).attr("tabindex")&&c.tabindex)||r.attr("tabindex",a(j).attr("tabindex"));r.removeClass(c.classes.placeholder.container.disabled);r.click(p);r.unbind("focusin").bind("focusin",q);r.focusout(i);r.keydown(o);r.hover(m,n)};var k=function(){a(j).attr("disabled","disabled");!c.tabindex||r.removeAttr("tabindex");r.addClass(c.classes.placeholder.container.disabled);r.unbind("click").click(function(){return false});r.unbind("keydown");r.unbind("focusin").bind("focusin",function(){this.blur();return false});r.unbind("focusout");r.unbind("mouseover");r.unbind("mouseout")};return function(){r=d(j);l();a(j).after(r);a(j).hide();return{enable:function(){l()},disable:function(){k()},destroy:function(){r.unbind();r.remove();a(j).removeAttr("disabled").show()}}}()};var b={init:function(i){c=a.extend({},a.fn.flyweightCustomSelect.settings,i);if(f===null){f=a.fn.flyweightCustomSelect.menu=new e();a(document).click(function(){if(f.isOpen()){f.reset()}})}return this.each(function(){if(!a(this).data("placeHolder")){a(this).data("placeHolder",new g(this))}})},destroy:function(){f.destroy();f=a.fn.flyweightCustomSelect.menu=null;return this.each(function(){a(this).data("placeHolder").destroy();a(this).data("placeHolder",null)})},enable:function(){return this.each(function(){a(this).data("placeHolder").enable()})},disable:function(){return this.each(function(){a(this).data("placeHolder").disable()})}};var d=(function(){if(a.browser.msie&&parseInt(a.browser.version,10)<7){return function(i){return a('<div class="'+c.classes.placeholder.container.base+'"><a href="#" aria-owns="'+i.id+'" role="button" href="#" aria-haspopup="true" id="'+i.id+'-button"><span class="'+c.classes.placeholder.text.base+'">'+i.options[i.selectedIndex].text+'</span><span class="'+c.classes.placeholder.arrow.base+'"></span></a></div>')}}else{return function(i){return a('<a href="#" aria-owns="'+i.id+'" class="'+c.classes.placeholder.container.base+'" role="button" href="#" aria-haspopup="true" id="'+i.id+'-button"><span class="'+c.classes.placeholder.text.base+'">'+i.options[i.selectedIndex].text+'</span><span class="'+c.classes.placeholder.arrow.base+'"></span></a>')}}})();if(b[h]){return b[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return b.init.apply(this,arguments)}else{a.error("Method "+h+" does not exist on jQuery.flyweightCustomSelect")}}};a.fn.flyweightCustomSelect.settings={classes:{placeholder:{container:{base:"fwselect",open:"fwselect-open",dropdown:"fwselect-drop-down",dropup:"fwselect-drop-up",hover:"fwselect-hover",focus:"fwselect-focus",disabled:"fwselect-disabled"},text:{base:"fwselect-text"},arrow:{base:"fwselect-arrow"}},menu:{container:{base:"fwselect-menu",open:"fwselect-menu-open",dropdown:"fwselect-menu-drop-down",dropup:"fwselect-menu-drop-up",},list:{base:"fwselect-menu-list"},listitem:{base:"fwselect-menu-listitem",focus:"fwselect-menu-listitem-focus",hover:"fwselect-menu-listitem-hover"},group:{base:"fwselect-menu-group"}}},optionfilter:"option,optgroup",tabindex:false,keymap:{left:37,right:39,up:38,down:40,enter:13,space:32,tab:9,pgup:33,pgdn:34,escape:27}}}(jQuery));